<html>

<script type="text/javascript" src="./docs/nools.js"></script>
<link rel="stylesheet" href="style/rules.css"></link>
<body>
    <p id ="output"></p> 
<script type="text/nools" id="simple">
    define Result {
        value: ''
    }
    define Message {
       obj:{},
        constructor : function (obj) {
            this.text = obj.message;
            this.id = obj.id;
            this.rules = obj.rules;   
            this.html = '';
        }        

    }
    rule Hello {
        
        when {           
            m : Message m.text =~ /^hello\sworld$/
        }
        then {
            modify(m, function(){              
                this.text += " goodbye " + this.id + ' ' + this.rules;
                this.html = formatSpan(this.id, this.rules, this.text);
            });
            
            
        }
    }
    

</script>
<script type="text/javascript">
    function formatSpan(id, rules, text) {
        var _str = '<span id="'+ id + '" class="' + ruleFormat(id, rules) + '">' + text + '</span>';
        return _str;
    }
    function ruleFormat(id, rule) {
        if(!rule) return rule;
        rule = rule.replace(/\s/g, ''); // remve any spaces
        if (rule.indexOf(',') > -1) {
            let rules = rule.split(',');
            rule = id;
            rules.map(function(elm){
                rule = rule + ' rule-' + elm;
            });
        } else {
            rule = id + ' rule-' + rule;
        }
        return rule;
    }
    function init() {
       //get the source
       var source = document.getElementById("simple").innerHTML;
       
             
       //console.log(source);
       //compile the source. The name option is required if compiling directly.
       var obj = {message:'hello world',id:'rule00001',rules:'bold, italic'};
       var flow = nools.compile(source, {name: "simple"}),
            Message = flow.getDefined("message");
            var m = new Message(obj);
           var session = flow.getSession(m);
            //console.log(flow)
      
        //assert your different messages
        //console.log(flow);  
          
        //session.assert(new Message('hello world','01','bold, italic'));
     
        //session.assert(new Message({message:'hello world',id:'01'}));
        //session.assert(new Message("goodbye"));
        //session.assert(new Message("hello world"));
        //this.html = '<span id="'+ this.id + '" class="' + this.rules + '">' + this.text + '</span>';

        //session.match();
        session.match(function(err){
            if(err){
                console.error(err);
            } else {
               
            };
         });
        //console.log(session.assert(new Message("Hello")));
        //console.log(session.assert(new Message("Uma")));
        //console.log(source);
        console.log(m.html);
        return m.html;
    }
    var str = init();
    document.getElementById("output").innerHTML +=  str ;   
</script>
</body>
</html>